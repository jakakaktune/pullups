<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pull-up Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&display=swap');

        .cloud {
            position: absolute;
            /* Use your preferred movement method, e.g., translateX */
            animation: drive linear infinite;
            animation-duration: var(--duration);
            animation-delay: var(--delay, 0s); 
            height: 100%;
        }

        @keyframes drive {
            from { transform: translateX(-150px); }
            to { transform: translateX(120vw); }
        }
    </style>
</head>

<body
    class="bg-gradient-to-b from-[#24273a] to-[#636ca0] min-h-screen overflow-x-hidden text-white font-['Lilita_One',sans-serif]">

    {% macro stat_card(label, value, show_star=False) %}
    <div
        class="group relative bg-[rgba(0,0,0,0.4)] backdrop-blur-sm rounded-[29px] p-6 transition-all duration-300 hover:bg-[rgba(0,0,0,0.5)] hover:scale-105 hover:shadow-2xl flex flex-col items-center justify-center min-h-[160px]">
        {% if show_star %}
        <div class="absolute -top-6 -left-6 flex items-center justify-center w-[66px] h-[66px] animate-pulse z-20">
            <svg class="w-12 h-12 text-yellow-400 rotate-[-24deg] drop-shadow-md" fill="currentColor"
                viewBox="0 0 24 24">
                <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
            </svg>
        </div>
        {% endif %}
        <span class="text-[32px] leading-tight opacity-90 mb-1">{{ label }}</span>
        <span class="text-[75px] leading-none drop-shadow-lg">{{ value }}</span>
    </div>
    {% endmacro %}

    <div id="skybox" class="absolute h-[100vh] w-[100vw] min-h-screen overflow-hidden z-[-2]">
        <div class="absolute w-[120vw] h-[4vh] -left-[10vw] top-[85%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[5vh] -left-[10vw] top-[70%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[7vh] -left-[10vw] top-[55%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[7vh] -left-[10vw] top-[45%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[10vh] -left-[10vw] top-[35%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[10vh] -left-[10vw] top-[25%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[10vh] -left-[10vw] top-[15%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[15vh] -left-[10vw] top-[10%] skybox__row"></div>
        <div class="absolute w-[120vw] h-[20vh] -left-[10vw] top-[0%] skybox__row"></div>
    </div>

    <div
        class="relative z-10 container mx-auto px-8 py-12 max-w-[1400px] min-h-screen flex flex-col md:flex-row gap-12">

        <div class="flex-1">
            <header class="mb-12">
                <h1 class="text-[64px] drop-shadow-2xl mb-4">Pull-up Buddy</h1>
            </header>

            <section class="mb-16">
                <h2 class="text-[48px] mb-8 drop-shadow-lg">{{ current_month_name }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl">
                    {{ stat_card('Day', stats.today, goals_met.day) }}
                    {{ stat_card('Week', stats.this_week, goals_met.week) }}
                    {{ stat_card('Month', stats.this_month, goals_met.month) }}
                </div>
            </section>

            <section>
                <h2 class="text-[48px] mb-8 drop-shadow-lg">All time records</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl mb-6">
                    {{ stat_card('Day', stats.max_day) }}
                    {{ stat_card('Week', stats.max_week) }}
                    {{ stat_card('Month', stats.max_month) }}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl">
                    {{ stat_card('Single rep', stats.max_set) }}
                    {{ stat_card('Single session', stats.max_session) }}
                </div>
            </section>
        </div>

        <div class="fixed right-0 bottom-0 h-[80vh] aspect-[1.5] flex items-end justify-end z-[-1]">
            <div class="relative h-full w-8 border border-4 border-b-0 border-black">
                <div style="bottom: {{ progress_percent }}%; transform: translateY(77%);"
                    class="absolute transition-all duration-[2000ms] ease-out z-20">
                    <img src="/public/pullup-dude-up.svg" id="climber"
                        class="w-10 h-10 object-contain drop-shadow-[0_0_15px_rgba(255,255,255,0.8)]" alt="Climber">
                </div>
            </div>

            <div class="h-[10%]">
                <img src="/public/gediminas.svg" class="h-[100%] object-contain drop-shadow-2xl" alt="Gediminas Tower">
                <!-- <span class="text-xl opacity-80 mt-2 drop-shadow-md tracking-wider">Gediminas</span> -->
            </div>

            <div class="h-[30%]">
                <!-- <span class="text-xl opacity-80 mb-2 drop-shadow-md tracking-wider">Pilsotas</span> -->
                <img src="/public/pilsotas.svg" class="h-[100%] object-contain drop-shadow-2xl" alt="Pilsotas">
            </div>

            <div class="h-[100%]">
                <img src="/public/tv-tower.svg" class="h-[100%] object-contain drop-shadow-2xl" alt="Vilnius TV Tower">
            </div>

        </div>
    </div>

    <script>

        // climber animation
        let climberImage = document.getElementById('climber');
        let srcs = ['/public/pullup-dude-up.svg', '/public/pullup-dude-down.svg'];
        let index = 1;
        setInterval(() => {
            // change the attribute
            climberImage.setAttribute('src', srcs[index]);
            // flip the index
            index = index == 1 ? 0 : 1;
        }, 1000);

        // clouds
        // we divide the screen in 9 rows.
        // each row can spontaniously spawn a cloud, and its size will depend on the row its in (the bigger the row, the lower it appears, the smaller it should be);

        let rows = [...document.querySelectorAll('.skybox__row')];

        function addCloud(y, isInitial = false) {
            // 1. Fix the row index (nth-child is 1-based, so we ensure y is 1-9)
            const rowIndex = Math.max(1, Math.min(y, 9));
            const parent = document.querySelector(`.skybox__row:nth-child(${rowIndex})`);
            if (!parent) return;

            // 2. Sprite & Duration Logic (Your existing logic)
            let spriteIndex = Math.ceil(Math.random() * 3);
            let min, max;

            if (rowIndex <= 3) { // Top rows: Small/Slow
                min = 50; max = 80;
            } else if (rowIndex <= 6) { // Mid rows: Medium
                min = 35; max = 50;
            } else { // Bottom rows: Large/Fast
                min = 20; max = 30;
            }

            const duration = (Math.floor(Math.random() * (max - min + 1)) + min) * 2;

            // 3. Create the element
            let img = document.createElement('img');
            img.src = `/public/cloud-${spriteIndex}.svg`;
            img.className = 'cloud';

            // 4. THE SEEDING TWEAK
            // If it's an initial cloud, we give it a random negative delay
            // This makes it appear halfway through its flight immediately.
            let delay = isInitial ? -(Math.random() * duration) : 0;

            img.style.setProperty('--duration', `${duration}s`);
            img.style.setProperty('--delay', `${delay}s`);

            parent.appendChild(img);
        }

        // Seed the initial clouds
        for (let i = 0; i < 15; i++) {
            // Math.random() * 9 + 1 gives us a range of 1 to 9.99
            addCloud(Math.floor(Math.random() * 9) + 1, true);
        }


    </script>
</body>

</html>